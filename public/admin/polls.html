<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×¡×§×¨×™× ×•×”×¦×‘×¢×•×ª - ××¢×¨×›×ª × ×™×”×•×œ ×™×™×©×•×‘ ××™×¦×“</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/admin/admin.css">
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <div class="admin-layout">
    <aside class="admin-sidebar">
      <div class="sidebar-header">
        <h2>××™×¦×“</h2>
        <span>××¢×¨×›×ª × ×™×”×•×œ ×™×™×©×•×‘</span>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <span class="nav-section-title">×¨××©×™</span>
          <a href="/admin/dashboard.html" class="nav-item">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-text">×œ×•×— ×‘×§×¨×”</span>
          </a>
          <a href="/admin/requests.html" class="nav-item">
            <span class="nav-icon">ğŸ“¬</span>
            <span class="nav-text">×¤× ×™×•×ª ×ª×•×©×‘×™×</span>
            <span class="nav-badge" id="newRequestsBadge">0</span>
          </a>
        </div>

        <div class="nav-section">
          <span class="nav-section-title">×§×”×™×œ×”</span>
          <a href="/admin/events.html" class="nav-item">
            <span class="nav-icon">ğŸ“…</span>
            <span class="nav-text">×œ×•×— ××™×¨×•×¢×™×</span>
          </a>
          <a href="/admin/announcements.html" class="nav-item">
            <span class="nav-icon">ğŸ“¢</span>
            <span class="nav-text">×”×•×“×¢×•×ª ×•×”×›×¨×–×•×ª</span>
            <span class="nav-badge urgent" id="urgentAnnouncementsBadge" style="display:none">!</span>
          </a>
          <a href="/admin/directory.html" class="nav-item">
            <span class="nav-icon">ğŸ“–</span>
            <span class="nav-text">×¡×¤×¨ ×˜×œ×¤×•× ×™×</span>
          </a>
          <a href="/admin/polls.html" class="nav-item active">
            <span class="nav-icon">ğŸ—³ï¸</span>
            <span class="nav-text">×¡×§×¨×™× ×•×”×¦×‘×¢×•×ª</span>
          </a>
        </div>

        <div class="nav-section">
          <span class="nav-section-title">××©××‘×™×</span>
          <a href="/admin/facilities.html" class="nav-item">
            <span class="nav-icon">ğŸ›ï¸</span>
            <span class="nav-text">×”×–×× ×ª ××ª×§× ×™×</span>
            <span class="nav-badge" id="pendingBookingsBadge" style="display:none">0</span>
          </a>
          <a href="/admin/documents.html" class="nav-item">
            <span class="nav-icon">ğŸ“„</span>
            <span class="nav-text">××¡××›×™× ×•× ×”×œ×™×</span>
          </a>
          <a href="/admin/maintenance.html" class="nav-item">
            <span class="nav-icon">ğŸ”§</span>
            <span class="nav-text">×ª×—×–×•×§×”</span>
          </a>
        </div>

        <div class="nav-section">
          <span class="nav-section-title">× ×™×”×•×œ</span>
          <a href="/admin/meetings.html" class="nav-item">
            <span class="nav-icon">ğŸ—“ï¸</span>
            <span class="nav-text">×™×©×™×‘×•×ª ×•×¤×¨×•×˜×•×§×•×œ×™×</span>
          </a>
          <a href="/admin/budget.html" class="nav-item">
            <span class="nav-icon">ğŸ’°</span>
            <span class="nav-text">×ª×§×¦×™×‘ ×•×›×¡×¤×™×</span>
          </a>
          <a href="/admin/planning.html" class="nav-item">
            <span class="nav-icon">ğŸ“‹</span>
            <span class="nav-text">×ª×›× ×•×Ÿ ×•×¤×¨×•×™×§×˜×™×</span>
          </a>
          <a href="/admin/employees.html" class="nav-item">
            <span class="nav-icon">ğŸ‘¥</span>
            <span class="nav-text">×¢×•×‘×“×™×</span>
          </a>
          <a href="/admin/infrastructure.html" class="nav-item">
            <span class="nav-icon">ğŸ—ï¸</span>
            <span class="nav-text">×ª×©×ª×™×•×ª</span>
          </a>
          <a href="/admin/settings.html" class="nav-item">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-text">×”×’×“×¨×•×ª</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <a href="/citizen/submit.html" class="nav-item" target="_blank">
          <span class="nav-icon">ğŸ“</span>
          <span class="nav-text">×¤×•×¨×˜×œ ×ª×•×©×‘×™×</span>
        </a>
        <a href="/" class="nav-item">
          <span class="nav-icon">ğŸ </span>
          <span class="nav-text">×œ××ª×¨ ×”×¨××©×™</span>
        </a>
        <a href="#" class="nav-item" onclick="logout()">
          <span class="nav-icon">ğŸšª</span>
          <span class="nav-text">×”×ª× ×ª×§×•×ª</span>
        </a>
      </div>
    </aside>

    <button class="admin-menu-toggle" onclick="toggleSidebar()">â˜°</button>

    <main class="admin-main">
      <header class="admin-header">
        <div class="header-right"><h1>ğŸ—³ï¸ ×¡×§×¨×™× ×•×”×¦×‘×¢×•×ª</h1></div>
        <div class="header-left">
          <button class="btn btn-primary" onclick="showCreatePoll()">â• ×¡×§×¨ ×—×“×©</button>
        </div>
      </header>

      <div class="admin-content">
        <section class="stats-grid small">
          <div class="stat-card mini"><div class="stat-icon info">ğŸ“Š</div><div class="stat-info"><span class="stat-value" id="totalPolls">3</span><span class="stat-label">×¡×”"×› ×¡×§×¨×™×</span></div></div>
          <div class="stat-card mini"><div class="stat-icon progress">âœ…</div><div class="stat-info"><span class="stat-value" id="activePolls">2</span><span class="stat-label">×¤×¢×™×œ×™×</span></div></div>
          <div class="stat-card mini"><div class="stat-icon resolved">ğŸ‘¥</div><div class="stat-info"><span class="stat-value" id="totalVotes">156</span><span class="stat-label">×”×¦×‘×¢×•×ª</span></div></div>
          <div class="stat-card mini"><div class="stat-icon time">ğŸ“ˆ</div><div class="stat-info"><span class="stat-value" id="avgParticipation">68%</span><span class="stat-label">×”×©×ª×ª×¤×•×ª ×××•×¦×¢×ª</span></div></div>
        </section>

        <div class="polls-container" id="pollsContainer">
          <!-- Polls loaded here -->
        </div>
      </div>
    </main>
  </div>

  <div id="toast" class="toast hidden"></div>

  <script>
    const polls = [
      {
        id: 1,
        title: '×‘×—×™×¨×ª ××™×§×•× ×œ×’×Ÿ ××©×—×§×™× ×—×“×©',
        status: 'active',
        end_date: '2026-02-15',
        total_votes: 78,
        options: [
          { text: '×œ×™×“ ×‘×™×ª ×”×§×”×™×œ×”', votes: 35 },
          { text: '×‘×©×›×•× ×” ×”×¦×¤×•× ×™×ª', votes: 28 },
          { text: '×œ×™×“ ×‘×™×ª ×”×¡×¤×¨', votes: 15 }
        ]
      },
      {
        id: 2,
        title: '×”×¢×“×¤×ª ×ª××¨×™×š ×œ××™×¨×•×¢ ×©×‘×•×¢×•×ª',
        status: 'active',
        end_date: '2026-02-28',
        total_votes: 45,
        options: [
          { text: '×™×•× ×©×™×©×™ ×‘×¢×¨×‘', votes: 22 },
          { text: '×©×‘×ª ×‘×¦×”×¨×™×™×', votes: 18 },
          { text: '×©×‘×ª ×‘×¢×¨×‘', votes: 5 }
        ]
      },
      {
        id: 3,
        title: '×¡×§×¨ ×©×‘×™×¢×•×ª ×¨×¦×•×Ÿ 2025',
        status: 'closed',
        end_date: '2025-12-31',
        total_votes: 112,
        options: [
          { text: '××¨×•×¦×” ×××•×“', votes: 45 },
          { text: '××¨×•×¦×”', votes: 42 },
          { text: '×¤×—×•×ª ××¨×•×¦×”', votes: 20 },
          { text: '×œ× ××¨×•×¦×”', votes: 5 }
        ]
      }
    ];

    function renderPolls() {
      const container = document.getElementById('pollsContainer');

      container.innerHTML = polls.map(poll => {
        const maxVotes = Math.max(...poll.options.map(o => o.votes));

        return `
          <div class="poll-card ${poll.status}">
            <div class="poll-header">
              <h3>${poll.title}</h3>
              <span class="poll-status status-badge status-${poll.status === 'active' ? 'in_progress' : 'closed'}">
                ${poll.status === 'active' ? '×¤×¢×™×œ' : '×”×¡×ª×™×™×'}
              </span>
            </div>
            <div class="poll-options">
              ${poll.options.map(opt => {
                const percentage = poll.total_votes > 0 ? Math.round((opt.votes / poll.total_votes) * 100) : 0;
                return `
                  <div class="poll-option">
                    <div class="option-header">
                      <span class="option-text">${opt.text}</span>
                      <span class="option-votes">${opt.votes} (${percentage}%)</span>
                    </div>
                    <div class="option-bar">
                      <div class="option-fill" style="width: ${percentage}%"></div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
            <div class="poll-footer">
              <span>ğŸ“Š ${poll.total_votes} ×”×¦×‘×¢×•×ª</span>
              <span>ğŸ“… ${poll.status === 'active' ? '××¡×ª×™×™×' : '×”×¡×ª×™×™×'}: ${new Date(poll.end_date).toLocaleDateString('he-IL')}</span>
            </div>
          </div>
        `;
      }).join('');
    }

    function showCreatePoll() {
      showToast('×™×¦×™×¨×ª ×¡×§×¨ - ×‘×§×¨×•×‘', 'info');
    }

    function toggleSidebar() {
      document.querySelector('.admin-sidebar').classList.toggle('open');
    }

    function logout() {
      localStorage.removeItem('authToken');
      window.location.href = '/#login';
    }

    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type}`;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 4000);
    }

    renderPolls();
  </script>

  <style>
    .polls-container { display: flex; flex-direction: column; gap: var(--space-6); }
    .poll-card { background: white; border-radius: var(--radius-xl); padding: var(--space-6); border: 1px solid var(--gray-100); }
    .poll-card.closed { opacity: 0.8; }
    .poll-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-5); }
    .poll-header h3 { font-size: 1.2rem; font-weight: 700; }
    .poll-options { display: flex; flex-direction: column; gap: var(--space-3); margin-bottom: var(--space-4); }
    .poll-option { }
    .option-header { display: flex; justify-content: space-between; margin-bottom: var(--space-1); font-size: 0.9rem; }
    .option-votes { color: var(--gray-500); font-weight: 600; }
    .option-bar { height: 24px; background: var(--gray-100); border-radius: var(--radius-full); overflow: hidden; }
    .option-fill { height: 100%; background: var(--gradient-primary); border-radius: var(--radius-full); transition: width 0.5s ease; }
    .poll-footer { display: flex; gap: var(--space-6); color: var(--gray-500); font-size: 0.85rem; padding-top: var(--space-4); border-top: 1px solid var(--gray-100); }
  </style>
</body>
</html>
