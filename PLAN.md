# תכנית עבודה מפורטת - מערכת ניהול יישוב מיצד

## סקירת המערכת

מערכת ניהול מקיפה ליישוב מיצד המשמשת כמרכז שליטה ובקרה לוועד היישוב. כוללת ניהול פניות תושבים, תקציב, ישיבות, עובדים ופרויקטים.

---

## מודולים ופונקציונליות

### 1. מסך התחברות (Login Screen)

#### כפתורים ופעולות:
| כפתור | מזהה | פעולה |
|--------|------|-------|
| התחברות | login-form submit | שליחת email/password ל-API, שמירת JWT ב-localStorage, מעבר למסך הראשי |
| הצג/הסתר סיסמה | toggle-password | החלפת type בין password ל-text |
| שכחתי סיסמה | forgot-password-link | **לממש** - שליחת קישור איפוס למייל |
| זכור אותי | remember-me | שמירת העדפה (מוכן אך לא מנוצל) |

#### זרימת עבודה:
```
משתמש מזין פרטים → אימות בשרת → קבלת JWT → שמירה ב-localStorage → הצגת מסך ראשי
```

---

### 2. ניווט ראשי (Navigation)

#### סרגל צד (Desktop):
| כפתור | מודול | פעולה |
|--------|-------|-------|
| לוח בקרה | dashboard | טעינת Dashboard.load() |
| תקציב וכספים | budget | טעינת Budget.load() |
| תכנון ובנייה | planning | טעינת Planning.load() |
| פניות תושבים | inquiries | טעינת Inquiries.load() |
| ישיבות ופרוטוקולים | meetings | טעינת Meetings.load() |
| ניהול עובדים | employees | טעינת Employees.load() |
| הגדרות | settings | טעינת Settings.load() |
| צמצם תפריט | sidebar-toggle | הרחבה/צמצום סרגל צד |
| התנתקות | logout-btn | אישור + ניקוי token + חזרה להתחברות |

#### ניווט נייד (Mobile):
| כפתור | פעולה |
|--------|-------|
| בית | מעבר ל-dashboard |
| פניות | מעבר ל-inquiries |
| תקציב | מעבר ל-budget |
| ישיבות | מעבר ל-meetings |
| עוד | פתיחת תפריט נוסף |

#### תפריט נוסף (More Menu):
- תכנון ובנייה
- ניהול עובדים
- הגדרות
- התנתקות

---

### 3. לוח בקרה (Dashboard)

#### תצוגה:
- **יתרת תקציב** - סכום נוכחי + אחוז שינוי
- **פניות פתוחות** - מספר + טרנד
- **ישיבה הבאה** - תאריך
- **עובדים פעילים** - מספר

#### כפתורים:
| כפתור | פעולה |
|--------|-------|
| צפה בהכל (פניות) | מעבר ל-#inquiries |
| צפה בהכל (ישיבות) | מעבר ל-#meetings |
| פרטים (תקציב) | מעבר ל-#budget |

---

### 4. תקציב וכספים (Budget)

#### טאבים:
1. **סקירה כללית** - גרף קו + סיכום + תנועות אחרונות
2. **הכנסות** - רשימת הכנסות
3. **הוצאות** - רשימת הוצאות
4. **דוחות** - יצירת דוחות

#### כפתורים:
| כפתור | פעולה |
|--------|-------|
| תנועה חדשה | פתיחת מודל להוספת הכנסה/הוצאה |
| דוח חודשי | יצירת דוח לחודש הנוכחי |
| דוח רבעוני | יצירת דוח ל-3 חודשים |
| דוח שנתי | יצירת דוח שנתי |
| דוח מותאם | בחירת טווח תאריכים |
| עריכה/מחיקה | לכל תנועה בטבלה |

---

### 5. פניות תושבים (Inquiries)

#### טאבים:
1. **כל הפניות** - טבלה מלאה
2. **חדשות** - פניות בסטטוס "חדש"
3. **בטיפול** - פניות בסטטוס "בטיפול"
4. **טופלו** - פניות בסטטוס "טופל/סגור"

#### פילטרים:
- חיפוש טקסט חופשי
- סינון לפי קטגוריה
- סינון לפי תאריך (היום/השבוע/החודש)

#### כפתורים:
| כפתור | פעולה |
|--------|-------|
| ייצוא | הורדת CSV עם כל הפניות |
| צפייה (שורה) | פתיחת מודל פרטי פנייה |
| עדכון סטטוס | פתיחת מודל לעדכון סטטוס |
| שלח וואטסאפ | פתיחת wa.me עם הודעה מוכנה |

#### מעקב סטטוסים:
```
חדש → בטיפול → ממתין → טופל → סגור
```

---

### 6. ישיבות ופרוטוקולים (Meetings)

#### טאבים:
1. **ישיבות קרובות** - רשימת ישיבות עתידיות
2. **ישיבות קודמות** - ארכיון
3. **פרוטוקולים** - העלאה ותמלול

#### כפתורים:
| כפתור | פעולה |
|--------|-------|
| ישיבה חדשה | פתיחת מודל יצירת ישיבה |
| העלאת הקלטה | גרירה או בחירת קובץ |
| צפייה בפרוטוקול | הצגת תמלול |

---

### 7. ניהול עובדים (Employees)

#### טאבים:
1. **רשימת עובדים** - כרטיסי עובדים
2. **נוכחות** - דוח נוכחות יומי
3. **שכר ותשלומים** - סיכום משכורות
4. **לוח זמנים** - תצוגת לוח שנה

#### כפתורים:
| כפתור | פעולה |
|--------|-------|
| עובד חדש | פתיחת מודל הוספת עובד |
| שלח וואטסאפ | יצירת קשר עם עובד |
| עריכה | עדכון פרטי עובד |
| יום קודם/הבא | ניווט בלוח נוכחות |

---

### 8. תכנון ובנייה (Planning)

#### טאבים:
1. **פרויקטים** - לוח Kanban
2. **היתרים** - רשימת היתרי בנייה
3. **מפת תכנון** - תצוגה מפתית

#### עמודות Kanban:
- בתכנון
- בביצוע
- הושלם

#### כפתורים:
| כפתור | פעולה |
|--------|-------|
| פרויקט חדש | יצירת כרטיס פרויקט |
| גרירת כרטיס | שינוי סטטוס |

---

### 9. הגדרות (Settings)

#### קטגוריות:
1. **פרטי משתמש** - שם, אימייל, טלפון
2. **אבטחה** - שינוי סיסמה
3. **התראות** - אימייל/וואטסאפ/סיכום יומי
4. **תצוגה** - מצב כהה/אנימציות
5. **ניהול מערכת** - משתמשים/קטגוריות/גיבוי

#### כפתורים:
| כפתור | מזהה | פעולה |
|--------|------|-------|
| שמירת שינויים | user-settings-form | עדכון פרטי משתמש |
| עדכון סיסמה | password-change-form | שינוי סיסמה |
| ניהול משתמשים | manage-users-btn | **לממש** |
| קטגוריות פניות | manage-categories-btn | **לממש** |
| הגדרות אימייל | email-settings-btn | **לממש** |
| הגדרות וואטסאפ | whatsapp-settings-btn | **לממש** |
| גיבוי נתונים | backup-btn | יצירת גיבוי |

---

## באגים שתוקנו

### 1. Memory Leak במודלים (Critical)
**קובץ:** `utils.js` שורות 233-235
**בעיה:** כל פתיחת מודל מוסיפה event listener חדש ללא ניקוי
**פתרון:** שימוש ב-event delegation או ניקוי listeners קודמים

### 2. CSV Export לא מוגן מ-Injection
**קובץ:** `inquiries.js` שורות 315-317
**בעיה:** תווים מיוחדים (פסיקים, גרשיים) שוברים את הקובץ
**פתרון:** escape לגרשיים כפולים בתוך התאים

### 3. Race Condition בחיפוש
**קובץ:** `inquiries.js` שורות 18-21
**בעיה:** תוצאות חיפוש עלולות להגיע בסדר שגוי
**פתרון:** ביטול בקשות קודמות (AbortController)

### 4. איפוס סיסמה לא ממומש
**קובץ:** `auth.js` שורות 172-175
**פתרון:** הוספת endpoint ושליחת מייל עם קישור

### 5. וולידציה חסרה בטפסים
**בעיה:** אפשר לשמור נתונים לא תקינים
**פתרון:** בדיקת שדות חובה + פורמטים לפני שליחה

### 6. זרימת סטטוס לא מאומתת
**בעיה:** אפשר לקפוץ מ"חדש" ל"סגור"
**פתרון:** הגדרת מעברים מותרים בלבד

### 7. חסר מצב טעינה עם timeout
**בעיה:** כפתור נשאר disabled לנצח אם הרשת נתקעת
**פתרון:** timeout אוטומטי + הודעת שגיאה

### 8. כפילות בקונפיגורציית API
**קבצים:** `firebase-config.js` ו-`utils.js`
**פתרון:** הסרת הכפילות מ-utils.js

### 9. תמיכה באופליין
**בעיה:** פעולות נאבדות ללא רשת
**פתרון:** הודעה ברורה + שמירה מקומית

---

## שיפורים נוספים

### 1. הודעות למשתמש
- [ ] שליחת התראה בעדכון סטטוס פנייה
- [ ] התראה על ישיבה קרובה
- [ ] סיכום יומי

### 2. UX
- [ ] Loading skeleton במקום spinner
- [ ] Pagination בטבלאות ארוכות
- [ ] גלילה אינסופית

### 3. אבטחה
- [ ] Rate limiting בצד לקוח
- [ ] הסרת console.log בייצור
- [ ] CSP headers

---

## פריסה

### GitHub
```bash
git add .
git commit -m "Fix bugs and improvements"
git push origin main
```

### Render
- Auto-deploy מופעל על main branch
- Environment variables מוגדרים
- URL: https://meitzad-nihul.onrender.com

---

*עודכן: 2026-01-20*
